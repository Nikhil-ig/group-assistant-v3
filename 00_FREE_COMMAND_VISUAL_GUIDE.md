# ğŸ¨ /FREE Command - Visual Guide & Feature Map

## ğŸ“± User Interface

### Menu Display

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ”“ ADVANCED CONTENT & BEHAVIOR MANAGER     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘¤ Target User: @username (123456789)
ğŸ‘¥ Group: 987654321

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ CONTENT RESTRICTIONS:
  ğŸ“ Text: âœ… Allowed
  ğŸ¨ Stickers: âŒ Blocked
  ğŸ¬ GIFs: âœ… Allowed
  ğŸ“¸ Media: âŒ Blocked
  ğŸ¤ Voice: âœ… Allowed
  ğŸ”— Links: âœ… Allowed

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ BEHAVIOR FILTERS:
  ğŸŒŠ Floods: âœ… Enabled (Auto-delete spam)
  ğŸ“¨ Spam: âŒ Disabled (Detect links/mentions)
  âœ… Checks: âœ… Enabled (Verify members)
  ğŸŒ™ Silence: âŒ Disabled (Night mode)

ğŸŒƒ NIGHT MODE: â­• Inactive

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ QUICK GUIDE:
Content: Click to toggle what user can send
Filters: Click to enable/disable auto-actions
Reset: Restore default permissions
Close: Dismiss this menu

Updates saved to database in real-time
```

---

## ğŸ›ï¸ Button Layout

### Grid Format

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚  â•” ğŸ“‹ CONTENT PERMISSIONS           â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ğŸ“ Text âœ…   â”‚ğŸ¨ Stickers âŒâ”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ğŸ¬ GIFs âœ…   â”‚ğŸ“¸ Media âŒ   â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ğŸ¤ Voice âœ…  â”‚ğŸ”— Links âœ…   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚
â”‚  â•  ğŸš¨ BEHAVIOR FILTERS              â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ğŸŒŠ Floods âœ… â”‚ğŸ“¨ Spam âŒ    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚âœ… Checks âœ… â”‚ğŸŒ™ Silence âŒ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸŒƒ Night Mode â­• Inactive    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  â•  ğŸ›ï¸ ACTIONS                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚â†» Reset All   â”‚âŒ Close      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Feature Matrix

### Content Types (Per-User)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Content     â”‚ API Field      â”‚ Default State   â”‚ Auto-Delete  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Text     â”‚ can_send_msgs  â”‚ âœ… Allowed     â”‚ âŒ No        â”‚
â”‚ ğŸ¨ Stickers â”‚ can_send_other â”‚ âœ… Allowed     â”‚ âœ… Yes       â”‚
â”‚ ğŸ¬ GIFs     â”‚ can_send_other â”‚ âœ… Allowed     â”‚ âœ… Yes       â”‚
â”‚ ğŸ“¸ Media    â”‚ can_send_media â”‚ âœ… Allowed     â”‚ âœ… Yes       â”‚
â”‚ ğŸ¤ Voice    â”‚ can_send_audio â”‚ âœ… Allowed     â”‚ âœ… Yes       â”‚
â”‚ ğŸ”— Links    â”‚ can_add_links  â”‚ âœ… Allowed     â”‚ âŒ No        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Media Types (Cascading with ğŸ“¸ Media)

```
ğŸ“¸ Media â†’ Includes:
  â”œâ”€ ğŸ“· Photos
  â”œâ”€ ğŸ¥ Videos
  â”œâ”€ ğŸ“„ Documents
  â”œâ”€ ğŸµ Audio Files
  â”œâ”€ ğŸ¤ Voice Notes (separate control)
  â””â”€ ğŸ“¹ Video Notes (separate control)
```

### Behavior Filters (Group-Level)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Filter       â”‚ Detects             â”‚ Threshold    â”‚ Action        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŒŠ Floods    â”‚ Rapid messages      â”‚ >4 msgs/5s   â”‚ Auto-delete   â”‚
â”‚ ğŸ“¨ Spam      â”‚ Links/mentions      â”‚ 3+ per msg   â”‚ Auto-delete   â”‚
â”‚ âœ… Checks    â”‚ New members         â”‚ All users    â”‚ CAPTCHA       â”‚
â”‚ ğŸŒ™ Silence   â”‚ Night mode hours    â”‚ Schedule     â”‚ Auto-delete   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ State Transitions

### Permission Toggle Flow

```
Current State: âœ… ALLOWED (can_send = True)
         â†“
User clicks button
         â†“
API call: toggle-permission
         â†“
Database updated
         â†“
New State: âŒ BLOCKED (can_send = False)
         â†“
Bot sends: "âœ… Stickers toggled"
```

### Media Detection & Delete Flow

```
User sends message
         â†“
Is it media? (sticker/GIF/photo/video/voice/etc)
         â†“ Yes
Get user permissions from API
         â†“
Is restricted? (can_send_X = False)
         â†“ Yes
Delete message
         â†“
Log action: {user_id, media_type, reason}
         â†“ No
Allow message
```

---

## ğŸ¯ Command Usage Paths

### Path 1: Direct User Specification

```
/free @john_spammer
         â†“
Bot loads user @john_spammer
         â†“
Shows menu with @john_spammer's current restrictions
         â†“
Admin clicks buttons to modify
```

### Path 2: User ID

```
/free 123456789
         â†“
Bot loads user 123456789
         â†“
Shows menu
         â†“
Admin modifies restrictions
```

### Path 3: Reply to Message

```
Admin: [Replies to John's message] /free
         â†“
Bot extracts John's user ID from reply
         â†“
Shows menu for John
         â†“
Admin modifies John's restrictions
```

---

## ğŸŒ™ Night Mode Integration

### Night Mode + /FREE Interaction

```
/nightmode (configure schedule)
    â†“
Night mode active from 10 PM - 6 AM
    â†“
Non-exempt users during night:
    - Can send: Text messages only
    - Auto-deleted: Stickers, GIFs, media, voice
    â†“
Exempt users during night:
    - Can send: Everything
    - Nothing auto-deleted
    â†“
/free @user â†’ Click ğŸŒƒ Night Mode
    â†“
Toggle user exemption:
    - â­ Personally exempt
    - ğŸ–ï¸ Exempt by role
    - âŒ No exemption
```

---

## ğŸ“ˆ Permission State Diagram

### User Permission Model

```
User â†’ Restrictions (per user, per group):
    â”œâ”€ can_send_messages
    â”‚   â”œâ”€ True: Can send text
    â”‚   â””â”€ False: âŒ Blocked
    â”œâ”€ can_send_other_messages
    â”‚   â”œâ”€ True: Stickers/GIFs allowed
    â”‚   â””â”€ False: âŒ Blocked
    â”œâ”€ can_send_media_messages
    â”‚   â”œâ”€ True: Photos/videos/docs allowed
    â”‚   â””â”€ False: âŒ Blocked
    â”œâ”€ can_send_audios
    â”‚   â”œâ”€ True: Voice/audio allowed
    â”‚   â””â”€ False: âŒ Blocked
    â”œâ”€ can_send_voice_notes
    â”‚   â”œâ”€ True: Voice notes allowed
    â”‚   â””â”€ False: âŒ Blocked
    â””â”€ can_add_web_page_previews
        â”œâ”€ True: Links allowed
        â””â”€ False: âŒ Blocked

Media Filter:
    User sends message with media
         â†“
    Check: can_send_media_messages?
         â†“ False
    DELETE â†’ Log
```

---

## ğŸ” Security Flow

### Admin Verification

```
User clicks button
    â†“
handle_free_callback() triggered
    â†“
Check: Is user admin?
    â†“ No
    â””â”€ Return: "âŒ Admin only"
    â†“ Yes
Check: Valid callback data?
    â†“ No
    â””â”€ Return: "Invalid data"
    â†“ Yes
Execute toggle/filter operation
```

### Permission Enforcement

```
Media Filter on new message:
    1. Check: Is from bot?
        â””â”€ Skip if yes
    2. Check: Is in group?
        â””â”€ Skip if private
    3. Check: Is command?
        â””â”€ Skip if command
    4. Detect media type
    5. Fetch permissions from API
    6. If restricted: Delete + Log
    7. If allowed: Continue
```

---

## ğŸ“Š Data Model

### User Restriction Document

```json
{
  "user_id": 123456789,
  "group_id": 987654321,
  "can_send_messages": true,           // ğŸ“ Text
  "can_send_other_messages": false,    // ğŸ¨ Stickers, ğŸ¬ GIFs
  "can_send_media_messages": false,    // ğŸ“¸ Photos/Videos/Docs
  "can_send_audios": true,             // ğŸ¤ Voice/Audio
  "can_send_voice_notes": true,        // ğŸ¤ Voice Notes
  "can_add_web_page_previews": true,   // ğŸ”— Links
  "restricted_at": "2026-01-18T21:22:00Z",
  "restricted_by": 111111111,
  "reason": "Spam restriction"
}
```

### Group Policy Document

```json
{
  "group_id": 987654321,
  "floods_enabled": true,
  "flood_threshold": 4,
  "flood_window": 5,
  "spam_enabled": true,
  "spam_threshold": 3,
  "checks_enabled": true,
  "checks_type": "captcha",
  "silence_enabled": false,
  "silence_type": "night_mode"
}
```

### Audit Log Entry

```json
{
  "group_id": 987654321,
  "user_id": 123456789,
  "action": "auto_delete",
  "media_type": "sticker",
  "reason": "Stickers restricted",
  "message_id": 555,
  "timestamp": "2026-01-18T21:22:30Z",
  "status": "success"
}
```

---

## ğŸ¬ Interaction Timeline

### Scenario: Restrict Spammer's Media

```
T=0s    Admin: /free @spammer
        Bot: Loads @spammer's data
        Bot: Fetches permissions from API
        Bot: Displays menu

T=0.5s  Bot: Menu shown with:
        ğŸ“¸ Media: âœ… Allowed
        ... (other options)

T=2s    Admin: Clicks ğŸ“¸ Media button
        Callback: free_toggle_media_{user_id}_{group_id}

T=2.5s  API: Toggle permission request received
        API: Updates database
        API: Returns success

T=3s    Bot: Receives API response
        Bot: Shows toast: "ğŸ“¸ Media toggled + auto-delete enabled âœ…"

T=3.5s  @spammer sends sticker
        media_filter_handler checks permissions
        Finds: can_send_media_messages = false
        Deletes sticker silently
        Logs: {user_id: spammer, media_type: sticker, ...}
```

---

## ğŸ¯ Icon Legend

```
âœ… = Allowed / Enabled / Success
âŒ = Blocked / Disabled / Not available
ğŸ” = Locked / Restricted
â­• = Off / Inactive / Neutral
ğŸŒ™ = Night mode / Scheduled / Special
âš ï¸ = Warning / Caution / Error
ğŸ“‹ = Content / Configuration / Settings
ğŸš¨ = Alert / Important / Behavior
ğŸ›ï¸ = Actions / Controls / Management
ğŸŒ™ = Time-based / Schedule
ğŸ“Š = Data / Statistics / Information
```

---

## ğŸš€ Performance Profile

### Operation Speeds

```
Menu Load:        ~500ms (2 API calls)
â”œâ”€ GET permissions
â””â”€ GET policies

Button Click:     ~1s (1 API call)
â”œâ”€ Toggle permission
â””â”€ Update database

Media Detection:  <10ms (local check)
â”œâ”€ Detect sticker/GIF/photo/etc
â””â”€ Check message type

Permission Check: ~200ms (1 API call)
â”œâ”€ GET user permissions
â””â”€ Evaluate restriction

Auto-Delete:      <100ms
â”œâ”€ Delete message
â””â”€ Log action
```

---

## ğŸ“¡ API Call Diagram

### Permission Flow

```
Client (Bot)
    â†“
GET /api/v2/groups/{gid}/users/{uid}/permissions
    â†“
API Server
    â†“
MongoDB (fetch permissions)
    â†“
Return: {can_send_messages: true, ...}
    â†“
Bot: Display current state
```

### Toggle Flow

```
Admin clicks button
    â†“
Client (Bot)
    â†“
POST /api/v2/groups/{gid}/enforcement/toggle-permission
{user_id, permission_type}
    â†“
API Server
    â†“
MongoDB (update state)
    â†“
Return: {success: true, new_state: {...}}
    â†“
Bot: Show feedback
```

---

## ğŸ¨ Visual Status Indicators

### Status Display Legend

```
âœ… ALLOWED      = User can send this content type
âŒ BLOCKED      = User cannot send, will be auto-deleted
âœ… ENABLED      = Filter/feature is active
âŒ DISABLED     = Filter/feature is inactive
ğŸŒ™ ACTIVE       = Night mode is currently running
â­• Inactive     = Night mode is off
ğŸ–ï¸ Exempt by role     = User's role exempts them
â­ Personally exempt  = User individually exempted
ğŸŒ™ ACTIVE + â­• Inactive = Night mode status display
```

---

## ğŸ“ User Education

### Quick Mental Model

```
Think of /free as a PERMISSION MANAGER:

Content Permissions = What users CAN send
â”œâ”€ ğŸ“ Text: Always allowed (toggle text)
â”œâ”€ ğŸ¨ Stickers: Can turn off
â”œâ”€ ğŸ¬ GIFs: Can turn off
â”œâ”€ ğŸ“¸ Media: Can turn off (blocks photos, videos, docs)
â”œâ”€ ğŸ¤ Voice: Can turn off
â””â”€ ğŸ”— Links: Can turn off

Behavior Filters = What group DISALLOWS
â”œâ”€ ğŸŒŠ Floods: Block spam message flood
â”œâ”€ ğŸ“¨ Spam: Block link/mention spam
â”œâ”€ âœ… Checks: Require CAPTCHA
â””â”€ ğŸŒ™ Silence: Night mode enforcement

Night Mode = Time-based automatic mode
â”œâ”€ Activates at configured hours
â”œâ”€ Auto-deletes non-text during hours
â””â”€ Can exempt users/roles
```

---

**Visual Documentation Complete! ğŸ¨**

Use this guide to understand the /free command's interface, data flow, and functionality at a glance.

---

*Last Updated: January 18, 2026*
